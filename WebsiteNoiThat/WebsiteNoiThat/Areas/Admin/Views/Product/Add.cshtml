@model WebsiteNoiThat.Models.ProductViewModel

@{
    ViewBag.Title = "Thêm sản phẩm";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
}

<h2>Thêm mới sản phẩm</h2>

@using (Html.BeginForm("Add", "Product", FormMethod.Post, new { enctype = "Multipart/form-data" }))
{
    @Html.AntiForgeryToken()

<div class="form-horizontal">
    <hr />
    @Html.ValidationSummary(true, "", new { @class = "text-danger" })

    <div class="form-group">
        @Html.HiddenFor(model => model.ProductId)
    </div>

    <div class="form-group">
        @Html.LabelFor(model => model.Name, "Tên sản phẩm", htmlAttributes: new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            @Html.EditorFor(model => model.Name, new { htmlAttributes = new { @class = "form-control", @required = "required" } })
            @Html.ValidationMessageFor(model => model.Name, "", new { @class = "text-danger" })
        </div>
    </div>

    <div class="form-group">
        @Html.LabelFor(model => model.CateId, "Danh mục", htmlAttributes: new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            @Html.DropDownListFor(model => model.CateId, ViewBag.ListCate as SelectList, "--- Chọn danh mục ---", new { @class = "form-control", @required = "required" })
            @Html.ValidationMessageFor(model => model.CateId, "", new { @class = "text-danger" })
        </div>
    </div>

    @*<div class="form-group">
            @Html.LabelFor(model => model.ProviderId, "Nhà cung cấp", htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.DropDownListFor(model => model.ProviderId, ViewBag.ListProvider as SelectList, "--- Chọn nhà cung cấp ---", new { @class = "form-control", @required = "required" })
                @Html.ValidationMessageFor(model => model.ProviderId, "", new { @class = "text-danger" })
            </div>
        </div>*@

    <div class="form-group">
        @Html.LabelFor(model => model.Price, "Giá bán (Mặc định)", htmlAttributes: new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            @Html.EditorFor(model => model.Price, new { htmlAttributes = new { @class = "form-control", @type = "number", @min = "0", @required = "required" } })
            @Html.ValidationMessageFor(model => model.Price, "", new { @class = "text-danger" })
            <small class="text-muted">Giá này sẽ được áp dụng cho biến thể mặc định.</small>
        </div>
    </div>

    <div class="form-group">
        @Html.LabelFor(model => model.Quantity, "Số lượng kho (Mặc định)",
            new { @class = "control-label col-md-2" })

        <div class="col-md-10">

            <!-- Hiển thị 0, không cho sửa -->
            <input type="number"
                   class="form-control"
                   value="0"
                   readonly
                   style="background-color:#f5f5f5; cursor:not-allowed;" />

            <!-- Giá trị thực gửi về server -->
            @Html.HiddenFor(model => model.Quantity, new { Value = 0 })

            @Html.ValidationMessageFor(model => model.Quantity, "", new { @class = "text-danger" })

            <small class="text-muted">
                <i class="fas fa-lock"></i>
                Số lượng mặc định là 0. Cập nhật số lượng sau khi thêm sản phẩm.
            </small>
        </div>
    </div>


    <!-- BỎ REQUIRED - CHO PHÉP NULL -->
    <div class="form-group">
        @Html.LabelFor(model => model.Discount, "Giảm giá (%) - Không bắt buộc", htmlAttributes: new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            @Html.EditorFor(model => model.Discount, new { htmlAttributes = new { @class = "form-control", @type = "number", @min = "0", @max = "100", @placeholder = "Để trống = 0%" } })
            @Html.ValidationMessageFor(model => model.Discount, "", new { @class = "text-danger" })
            <small class="text-muted"><i class="fas fa-info-circle"></i> Nếu để trống, mặc định là 0% (không giảm giá)</small>
        </div>
    </div>

    <!-- BỎ REQUIRED - CHO PHÉP NULL -->
    <div class="form-group">
        @Html.LabelFor(model => model.Photo, "Ảnh đại diện - Không bắt buộc", htmlAttributes: new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            <input type="file" id="UploadImage" name="UploadImage" class="form-control" accept="image/*" />
            @Html.ValidationMessageFor(model => model.Photo, "", new { @class = "text-danger" })
            <small class="text-muted">
                <i class="fas fa-info-circle"></i>
                Kích thước tối đa: <strong>50MB</strong>. Định dạng: JPG, PNG, GIF, BMP.
                Ảnh sẽ tự động được nén. Nếu không chọn, sẽ dùng ảnh mặc định.
            </small>
        </div>
    </div>

    <div class="form-group">
        @Html.LabelFor(model => model.Description, "Mô tả sản phẩm", htmlAttributes: new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            @Html.TextAreaFor(model => model.Description, new { @class = "form-control", rows = "5" })
            @Html.ValidationMessageFor(model => model.Description, "", new { @class = "text-danger" })
        </div>
    </div>

    <!-- BỎ REQUIRED - CHO PHÉP NULL -->
    <div class="form-group">
        @Html.LabelFor(model => model.StartDate, "Ngày bắt đầu KM - Không bắt buộc", htmlAttributes: new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            @Html.TextBoxFor(model => model.StartDate, "{0:yyyy-MM-dd}", new { @class = "form-control", @type = "date" })
            @Html.ValidationMessageFor(model => model.StartDate, "", new { @class = "text-danger" })
            <small class="text-muted"><i class="fas fa-info-circle"></i> Để trống nếu không có khuyến mại</small>
        </div>
    </div>

    <!-- BỎ REQUIRED - CHO PHÉP NULL -->
    <div class="form-group">
        @Html.LabelFor(model => model.EndDate, "Ngày kết thúc KM - Không bắt buộc", htmlAttributes: new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            @Html.TextBoxFor(model => model.EndDate, "{0:yyyy-MM-dd}", new { @class = "form-control", @type = "date" })
            @Html.ValidationMessage("ErrorDate", new { @class = "text-danger" })
            <small class="text-muted"><i class="fas fa-info-circle"></i> Để trống nếu không có khuyến mại</small>
        </div>
    </div>

    <div class="form-group">
        <div class="col-md-offset-2 col-md-10">
            <a href="@Url.Action("Show", "Product")" class="btn btn-default">
                <i class="fas fa-arrow-left"></i> Trở về danh sách
            </a>
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-plus-circle"></i> Thêm mới
            </button>
        </div>
    </div>
</div>
}

@section Scripts {
    <script>
        // Hiển thị tên file khi chọn ảnh
        document.getElementById('UploadImage').addEventListener('change', function (e) {
            if (e.target.files.length > 0) {
                var fileName = e.target.files[0].name;
                var fileSize = (e.target.files[0].size / (1024 * 1024)).toFixed(2);
                console.log('Đã chọn: ' + fileName + ' (' + fileSize + ' MB)');
            }
        });
    </script>
}